<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Bài kiểm tra Phụng Vụ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background-image: url('bukiphan.jpg'); /* ảnh nền bạn tải lên */
    background-size: cover;          /* ảnh phủ toàn màn hình */
    background-repeat: no-repeat;
    background-attachment: fixed;    /* cố định khi cuộn */
    background-position: center;
    backdrop-filter: blur(2px);      /* làm mờ nhẹ phía sau */
    margin: 0;
    padding: 0;
  }

  .quiz-box {
    max-width: 700px;
    margin: 50px auto;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    padding: 30px;
  }

  .choice {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 12px 16px;
    margin-bottom: 10px;
    background: #fff7ed; /* màu cam nhạt */
    transition: 0.3s;
  }

  .choice:hover {
    background-color: #fde68a;
    cursor: pointer;
    transform: scale(1.02);
  }

  .choice.correct {
    background-color: #bbf7d0;
    border-color: #10b981;
    color: #065f46;
  }

  .choice.wrong {
    background-color: #fecaca;
    border-color: #ef4444;
    color: #7f1d1d;
  }

  .timer {
    font-weight: bold;
    color: #dc3545;
  }

  .blink {
    animation: blinkEffect 0.3s ease-in-out 3;
  }

  @keyframes blinkEffect {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
  h2.section-title {
    text-align: center;
    color: #065f46;
    font-weight: bold;
    margin-bottom: 20px;
  }
</style>

</head>
<body>
  <div class="quiz-box">
    <h2 class="text-center mb-4">Bài kiểm tra 15'</h2>
    <h2 class="section-title">PHẦN TRẮC NGHIỆM</h2>
    <div id="quiz-content"></div>
    <p class="timer text-center mt-3">Thời gian còn lại: <span id="time">30</span> giây</p>
  </div>

  <script>
    // ======== TRẮC NGHIỆM =========
    const questions = [
      { text: "Câu 1. Mùa Chay bắt đầu khi nào?", choices: {A:"Lễ Chúa Giêsu chịu Phép Rửa", B:"Thứ Tư lễ Tro", C:"Thứ Bảy Tuần Thánh", D:"Tất cả đều sai"}, correct:"B" },
      { text: "Câu 2. Mùa Vọng gồm 4 Chúa Nhật bắt đầu từ Kinh chiều I Chúa Nhật I Mùa Vọng đến Kinh chiều ngày nào?", choices: {A:"Lễ Chúa Giêsu Chịu Phép Rửa", B:"Thứ Tư lễ Tro", C:"Vọng lễ Giáng Sinh", D:"Vọng lễ Phục Sinh"}, correct:"C" },
      { text: "Câu 3. Trong Mùa Giáng Sinh, chúng ta cần phải có tâm tình nào?", choices: {A:"Hết lòng cảm tạ Thiên Chúa là Cha, đã thương sai Con Một đến cứu độ nhân loại", B:"Không ngừng cộng tác với ơn Chúa để Mầu nhiệm Giáng Sinh đem lại ơn cứu độ cho bản thân và cho mọi người", C:"Luôn canh tân cuộc sống để ngày càng nên xứng đáng với ơn cứu độ Chúa ban và nên con thảo của Người", D:"Tất cả đều đúng"}, correct:"D" },
      { text: "Câu 4. Lễ Chúa Giêsu chịu Phép Rửa được cử hành trong mùa nào của năm Phụng vụ?", choices: {A:"Mùa Vọng", B:"Mùa Giáng Sinh", C:"Mùa Chay", D:"Mùa Phục Sinh"}, correct:"B" },
      { text: "Câu 5. Phụng Vụ Công Giáo gồm các mùa nào?", choices: {A:"Mùa Vọng – Mùa Giáng Sinh – Mùa Chay – Mùa Phục Sinh – Mùa Thường Niên", B:"Mùa Vọng – Mùa Giáng Sinh – Mùa Chay – Mùa Phục Sinh – Mùa Tạ Ơn", C:"Mùa Chay – Mùa Giáng Sinh – Mùa Vọng – Mùa Gieo Hạt – Mùa Lễ Lá", D:"Mùa Vọng – Mùa Chay – Mùa Giáng Sinh – Mùa Thu Hoạch – Mùa Thường Niên"}, correct:"A" },
      { text: "Câu 6. Mùa nào dưới đây là thời gian Hội Thánh chuẩn bị tâm hồn tín hữu tham dự Mầu nhiệm Tử nạn - Phục sinh của Đức Kitô?", choices: {A:"Mùa Vọng", B:"Mùa Giáng Sinh", C:"Mùa Chay", D:"Mùa Phục Sinh"}, correct:"C" },
      { text: "Câu 7. Mùa Vọng là thời gian người tín hữu chuẩn bị tâm hồn xứng đáng để làm gì?", choices: {A:"Đón chờ và mừng Chúa Kitô đến lần thứ nhất (Đại lễ Giáng Sinh) tại Bêlem xứ Palestina", B:"Hân hoan vì Chúa Kitô đã chiến thắng sự chết để sống lại vinh hiển", C:"Tỉnh thức và sẵn sàng đón chờ Chúa đến lần thứ hai trong vinh quang (ngày quang lâm, ngày cánh chung)", D:"Cả A và C đều đúng"}, correct:"D" },
      { text: "Câu 8. Mùa nào là thời gian Hội Thánh hân hoan mừng kính Mầu nhiệm Nhập thể, Con Thiên Chúa đến ngự giữa trần gian?", choices: {A:"Mùa Vọng", B:"Mùa Giáng Sinh", C:"Mùa Chay", D:"Mùa Phục Sinh"}, correct:"B" },
      { text: "Câu 9. Tư thế sẵn sàng và tỉnh thức trong Mùa Vọng được diễn tả như thế nào?", choices: {A:"Sống ngay thẳng thật thà, không dối trá gian ngoa, nhưng hết lòng suy phục Thiên Chúa qua tiếng nói của lương tâm và lời Hội Thánh dạy bảo", B:"Không thiếu sót việc bổn phận, sửa chữa những khuyết điểm như giận hờn, oán ghét, tị hiềm", C:"Dứt khoát xa lánh kiêu ngạo, tự cao, ương ngạnh, khinh miệt bạn bè…", D:"Tất cả đều đúng"}, correct:"D" },
      { text: "Câu 10. Sau khi chịu Phép Rửa tại sông Gio-đan, Chúa Giêsu đi đâu?", choices: {A:"Chúa Giêsu rao giảng Tin Mừng tại Ga-li-lê", B:"Chúa Giêsu ăn chay ròng rã 40 đêm ngày trong hoang địa", C:"Chúa Giêsu tiến vào đền thờ Giê-ru-sa-lem", D:"Tất cả đều sai"}, correct:"B" }
    ];

    const essayQuestion = {
      text: "Phụng vụ là gì?",
      keywords: [
        { word: ["thờ phượng Thiên Chúa"], point: 2 },
        { word: ["công khai"], point: 1.5 },
        { word: ["chính thức"], point: 1.5 }
      ],
      sample: "Phụng vụ là việc thờ phượng Thiên Chúa công khai và chính thức của toàn thể Hội Thánh."
    };

    let current = 0, scoreChoice = 0, timer, timeLeft = 30;
    let userAnswers = []; // lưu câu trả lời trắc nghiệm
    const quizContent = document.getElementById("quiz-content");
    const timeDisplay = document.getElementById("time");

    function startTimer() {
      clearInterval(timer);
      timeLeft = 30;
      timeDisplay.textContent = timeLeft;
      timer = setInterval(() => {
        timeLeft--;
        timeDisplay.textContent = timeLeft;
        if(timeLeft <= 0) { clearInterval(timer); nextQuestion(); }
      }, 1000);
    }

    function loadQuestion() {
      const q = questions[current];
      quizContent.innerHTML = `<h5>${q.text}</h5><div class="mt-3">
        ${Object.entries(q.choices).map(([k,v]) => `<div class="choice" data-key="${k}"><strong>${k}.</strong> ${v}</div>`).join('')}
      </div>`;
      document.querySelectorAll(".choice").forEach(btn => {
        btn.addEventListener("click", ()=>handleAnswer(btn.dataset.key, btn));
      });
      startTimer();
    }

    function handleAnswer(selectedKey, element) {
  clearInterval(timer);
  const q = questions[current];
  userAnswers.push({ question: q.text, selected: selectedKey, correct: q.correct });

  const allChoices = document.querySelectorAll(".choice");
  allChoices.forEach(btn => {
    btn.style.pointerEvents = "none";
    if (btn.dataset.key === q.correct) btn.classList.add("correct");
    else if (btn.dataset.key === selectedKey) btn.classList.add("wrong");
  });

  // Nếu đúng, cộng điểm
  if (selectedKey === q.correct) scoreChoice++;

  // Hiệu ứng nhấp nháy đáp án đúng 3 lần
  const correctEl = [...allChoices].find(btn => btn.dataset.key === q.correct);
  correctEl.classList.add("blink");

  // Sau khi nhấp nháy xong (khoảng 900ms), chuyển câu
  setTimeout(nextQuestion, 900);
}


    function nextQuestion() {
      current++;
      if(current < questions.length) loadQuestion();
      else showEssayPart();
    }

    // ======== TỰ LUẬN =========
    function showEssayPart() {
      document.querySelector(".timer").style.display = "none";
      document.querySelector(".section-title").textContent = "PHẦN TỰ LUẬN";
      quizContent.innerHTML = `<h5>${essayQuestion.text}</h5>
        <textarea id="essay" class="form-control mt-3" rows="4" placeholder="Nhập câu trả lời của bạn..."></textarea>
        <button id="submitEssay" class="btn btn-primary mt-3 w-100">Nộp bài</button>`;
      document.getElementById("submitEssay").addEventListener("click", checkEssay);
    }

    function checkEssay() {
      const ans = document.getElementById("essay").value.toLowerCase();
      let essayScore = 0;
      essayQuestion.keywords.forEach(item => {
        if(item.word.every(w => ans.includes(w))) essayScore += item.point;
      });
      if(essayScore > 5) essayScore = 5;
      const choiceScore = (scoreChoice / questions.length) * 5;
      const total = (choiceScore + essayScore).toFixed(2);

      // ======== HIỂN THỊ KẾT QUẢ & XEM LẠI BÀI =========
      quizContent.innerHTML = `<h4 class="text-center text-success mb-3">Hoàn thành bài kiểm tra!</h4>
        <p class="text-center fs-5">Điểm trắc nghiệm: ${choiceScore.toFixed(2)}/5</p>
        <p class="text-center fs-5">Điểm tự luận: ${essayScore}/5</p>
        <hr>
        <p class="text-center fw-bold fs-4">Tổng điểm: ${total}/10</p>
        <h5 class="mt-4">Xem lại bài làm:</h5>
        ${questions.map((q,i)=>`
          <div class="answer-box">
            <p><strong>${q.text}</strong></p>
            <p>Câu trả lời của bạn: <strong>${q.choices[userAnswers[i].selected]}</strong></p>
            <p>Đáp án đúng: <strong>${q.choices[q.correct]}</strong></p>
          </div>
        `).join('')}
        <div class="answer-box">
          <p><strong>${essayQuestion.text}</strong></p>
          <p>Câu trả lời của bạn: <strong>${ans}</strong></p>
          <p>Đáp án mẫu: <strong>${essayQuestion.sample}</strong></p>
        </div>
        <div class="text-center mt-3">
          <button class="btn btn-secondary" onclick="location.reload()">Làm lại</button>
        </div>`;
    }

    // ======== KHỞI TẠO =========
    loadQuestion();
  </script>
</body>
</html>
